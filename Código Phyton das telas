# app_recicla_visual.py
from flask import Flask, render_template_string, request, redirect, url_for, flash

app = Flask(__name__)
app.secret_key = 'dev-secret'  # para mensagens flash

# armazenamento em memória (temporário)
usuarios = []

# ---------------- Templates (HTML + CSS) ----------------
HOME_TEMPLATE = """
<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Recicla Junto — Início</title>
<style>
  :root{
    --green: #3DDC84;
    --dark: #0F1820;
    --muted: #b7c0bf;
    --card: rgba(255,255,255,0.04);
    font-family: "Montserrat", "Segoe UI", Roboto, Arial, sans-serif;
  }
  /* full-screen centered phone mock */
  html,body{height:100%;margin:0;background:var(--dark);-webkit-font-smoothing:antialiased;}
  .wrap{display:flex;align-items:center;justify-content:center;height:100%;padding:20px;}
  .phone{width:100%;max-width:420px;display:flex;justify-content:center;}
  .screen{
    width:360px;border-radius:28px;overflow:hidden;
    background: linear-gradient(180deg,#071018 0%, #0b1820 100%);
    box-shadow: 0 12px 40px rgba(0,0,0,0.6);position:relative;
  }

  /* recycle-symbol pattern as SVG background (repeating) */
  .bg-pattern{
    position:absolute;inset:0;
    background-image:
      radial-gradient(rgba(255,255,255,0.02) 1px, transparent 1px);
    background-size: 36px 36px;
  }
  .pattern-overlay{
    position:absolute;inset:0;
    background-image:
      /* small repeated recycle SVG tile */
      url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='120' height='120' viewBox='0 0 24 24'><g fill='%233DDC84' fill-opacity='0.12'><path d='M21.1 8.3l-1.4 1.4c-.4.4-1 .4-1.4 0l-1.2-1.2c-.4-.4-.4-1 0-1.4l1.4-1.4c.6-.6 1.7-.2 1.7.7v2c0 .4-.2.8-.5 1.1z'/><path d='M2.9 15.7l1.4-1.4c.4-.4 1-.4 1.4 0l1.2 1.2c.4.4.4 1 0 1.4l-1.4 1.4c-.6.6-1.7.2-1.7-.7v-2c0-.4.2-.8.5-1.1z'/><path d='M12 3c-1.7 0-3.2.8-4.2 2l1.4 1.4C9.6 6 10.7 5.5 12 5.5c2.2 0 4 1.8 4 4 0 .9-.3 1.8-.8 2.5l1.6.9C17.9 15.1 18.5 13.6 18.5 12c0-3.6-2.9-6.5-6.5-6.5z'/></g></svg>");
    background-repeat: repeat;
    background-size: 140px 140px;
    mix-blend-mode: screen;
    opacity:0.18;
  }

  .content{position:relative;padding:28px 22px 32px 22px; z-index:2; color:white}
  .brand{font-weight:800;font-size:28px;letter-spacing:1px;text-align:center;margin-top:12px}
  .tag{color:var(--green);text-align:center;margin-top:6px;font-weight:700}
  .subtitle{color:var(--muted);text-align:center;font-size:13px;margin-top:8px;line-height:1.2}
  .buttons{display:flex;flex-direction:column;gap:12px;margin-top:24px;padding:0 20px}
  .btn{
    display:block;text-align:center;padding:12px;border-radius:28px;border:none;font-weight:700;font-size:16px;color:var(--dark);
    background:var(--green);box-shadow: 0 8px 18px rgba(61,220,132,0.18);text-decoration:none;
  }
  .btn.secondary{background:transparent;color:var(--green);border:2px solid rgba(61,220,132,0.14);box-shadow:none}
  .footer{padding:16px 20px;color:var(--muted);font-size:12px;text-align:center}
  @media (max-width:380px){ .screen{width:320px} }
</style>
</head>
<body>
  <div class="wrap">
    <div class="phone">
      <div class="screen" role="main" aria-label="Recicla Junto - Home">
        <div class="bg-pattern"></div>
        <div class="pattern-overlay"></div>

        <div class="content">
          <div class="brand">RECICLA<br>JUNTO</div>
          <div class="subtitle">Transformando resíduos em futuro, lado a lado</div>

          <div class="buttons">
            <a class="btn" href="{{ url_for('login') }}">Condomínios</a>
            <a class="btn secondary" href="{{ url_for('login') }}">Cooperativas</a>
          </div>
        </div>

        <div class="footer">Design inspirado no material visual — utilizado apenas nesta apresentação</div>
      </div>
    </div>
  </div>
</body>
</html>
"""

LOGIN_TEMPLATE = """
<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Recicla Junto — Login</title>
<style>
 :root{--green:#3DDC84;--dark:#0F1820;--muted:#b7c0bf}
 html,body{height:100%;margin:0;background:var(--dark);font-family:"Montserrat","Segoe UI",Roboto,Arial,sans-serif;color:white}
 .wrap{display:flex;align-items:center;justify-content:center;height:100%;padding:20px}
 .card{width:360px;background:var(--dark);border-radius:22px;padding:26px;box-shadow:0 10px 40px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.03)}
 .brand{text-align:center;font-weight:800;color:white;font-size:26px}
 .subtitle{text-align:center;color:var(--muted);margin-top:8px;font-size:13px}
 form{margin-top:18px;display:flex;flex-direction:column;gap:12px}
 input{height:44px;border-radius:10px;border:none;padding:10px;font-size:15px}
 .input-green{background:var(--green);color:var(--dark);font-weight:700}
 .btn{height:44px;border-radius:10px;border:none;background:white;color:var(--dark);font-weight:800;cursor:pointer}
 .small{font-size:12px;color:var(--muted);text-align:center;margin-top:8px}
 a.link{color:var(--muted);text-decoration:none;font-size:12px;display:block;text-align:center;margin-top:10px}
 @media (max-width:380px){ .card{width:320px} }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="main">
      <div class="brand">RECICLA JUNTO</div>
      <div class="subtitle">Transformando resíduos em futuro, lado a lado</div>

      {% with messages = get_flashed_messages(category_filter=["error"]) %}
        {% if messages %}
          <div style="background:#fff1f2;color:#7f1d1d;padding:10px;border-radius:8px;margin-top:12px">{{ messages[0] }}</div>
        {% endif %}
      {% endwith %}

      <form method="post" action="{{ url_for('login') }}">
        <input class="input-green" type="email" name="email" placeholder="Email" required>
        <input class="input-green" type="password" name="senha" placeholder="Senha" required>
        <button class="btn" type="submit">Acessar</button>
      </form>

      <a class="link" href="{{ url_for('cadastro') }}">Iniciar meu cadastro</a>
      <div class="small">Acesso de demonstração — use emails fictícios</div>
    </div>
  </div>
</body>
</html>
"""

CAD_TEMPLATE = """
<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Recicla Junto — Cadastro</title>
<style>
 :root{--green:#3DDC84;--dark:#0F1820;--muted:#b7c0bf}
 html,body{height:100%;margin:0;background:var(--dark);font-family:"Montserrat","Segoe UI",Roboto,Arial,sans-serif;color:white}
 .wrap{display:flex;align-items:center;justify-content:center;height:100%;padding:18px}
 .card{width:360px;background:var(--dark);border-radius:22px;padding:18px 20px 26px 20px;box-shadow:0 10px 40px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.03)}
 .brand{text-align:center;font-weight:800;color:white;font-size:22px}
 .subtitle{text-align:center;color:var(--muted);margin-top:6px;font-size:12px}
 form{margin-top:14px;display:flex;flex-direction:column;gap:10px}
 input,select{height:44px;border-radius:10px;border:none;padding:10px;font-size:14px}
 input.input-solid{background:#0f2a22;color:var(--green);font-weight:700;padding-left:12px}
 .btn{height:46px;border-radius:10px;border:none;background:var(--green);color:var(--dark);font-weight:800;cursor:pointer}
 .back{display:block;text-align:center;color:var(--muted);text-decoration:none;margin-top:10px;font-size:13px}
 .users{margin-top:12px;color:var(--muted);font-size:13px}
 @media (max-width:380px){ .card{width:320px} }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="main">
      <div class="brand">RECICLA JUNTO</div>
      <div class="subtitle">Transformando resíduos em futuro, lado a lado</div>

      {% with messages = get_flashed_messages(category_filter=["success"]) %}
        {% if messages %}
          <div style="background:#ecfdf5;color:#064e3b;padding:10px;border-radius:8px;margin-top:12px">{{ messages[0] }}</div>
        {% endif %}
      {% endwith %}

      {% with errors = get_flashed_messages(category_filter=["error"]) %}
        {% if errors %}
          <div style="background:#fff1f2;color:#7f1d1d;padding:10px;border-radius:8px;margin-top:12px">{{ errors[0] }}</div>
        {% endif %}
      {% endwith %}

      <form method="post" action="{{ url_for('cadastro') }}">
        <input class="input-solid" type="email" name="email" placeholder="Email" value="{{ form.email|default('') }}" required>
        <input class="input-solid" type="text" name="nome" placeholder="Nome completo" value="{{ form.nome|default('') }}" required>
        <input class="input-solid" type="text" name="endereco" placeholder="Endereço (opcional)" value="{{ form.endereco|default('') }}">
        <select name="tipo" required>
          <option value="">Tipo de usuário</option>
          <option value="Morador" {% if form.tipo=='Morador' %}selected{% endif %}>Morador</option>
          <option value="Síndico" {% if form.tipo=='Síndico' %}selected{% endif %}>Síndico</option>
          <option value="Cooperativa" {% if form.tipo=='Cooperativa' %}selected{% endif %}>Cooperativa</option>
        </select>

        <button class="btn" type="submit">Cadastrar</button>
      </form>

      <a class="back" href="{{ url_for('login') }}">← Voltar para login</a>

      <div class="users">
        <strong>Usuários:</strong>
        <ul>
          {% for u in usuarios %}
            <li style="margin-top:6px">{{ u.nome }} — {{ u.email }} ({{ u.tipo }})</li>
          {% endfor %}
          {% if usuarios|length == 0 %}
            <li style="color:#6b7280;margin-top:6px">Nenhum usuário cadastrado ainda.</li>
          {% endif %}
        </ul>
      </div>
    </div>
  </div>
</body>
</html>
"""

# ---------------- Routes ----------------
@app.route('/')
def home():
    return render_template_string(HOME_TEMPLATE)

@app.route('/login', methods=['GET', 'POST'])
def login():
    if request.method == 'POST':
        email = request.form.get('email','').strip()
        senha = request.form.get('senha','').strip()
        # demo: aceita qualquer senha desde que email exista na lista
        found = next((u for u in usuarios if u['email'].lower()==email.lower()), None)
        if found:
            # sucesso (apenas demonstrativo)
            return redirect(url_for('home'))
        else:
            flash('Email não encontrado. Inicie seu cadastro.', 'error')
            return render_template_string(LOGIN_TEMPLATE)
    return render_template_string(LOGIN_TEMPLATE)

@app.route('/cadastro', methods=['GET', 'POST'])
def cadastro():
    form = {}
    if request.method == 'POST':
        form['email'] = request.form.get('email','').strip()
        form['nome'] = request.form.get('nome','').strip()
        form['endereco'] = request.form.get('endereco','').strip()
        form['tipo'] = request.form.get('tipo','').strip()
        if not form['email'] or not form['nome'] or not form['tipo']:
            flash('Preencha os campos obrigatórios: Email, Nome e Tipo.', 'error')
            return render_template_string(CAD_TEMPLATE, usuarios=usuarios, form=form)
        # verifica duplicidade simples
        if any(u['email'].lower()==form['email'].lower() for u in usuarios):
            flash('Email já cadastrado.', 'error')
            return render_template_string(CAD_TEMPLATE, usuarios=usuarios, form=form)
        usuarios.append({'email':form['email'],'nome':form['nome'],'endereco':form['endereco'],'tipo':form['tipo']})
        flash(f"Usuário '{form['nome']}' cadastrado com sucesso!", 'success')
        return redirect(url_for('cadastro'))
    return render_template_string(CAD_TEMPLATE, usuarios=usuarios, form=form)

# ---------------- Run ----------------
if __name__ == '__main__':
    # para acessar do celular na mesma rede, altere host para '0.0.0.0' quando for demonstrar no celular
    app.run(debug=True, host='127.0.0.1', port=5000)

